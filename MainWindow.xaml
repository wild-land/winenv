<Window x:Class="WinEnv.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:WinEnv.ViewModels"
        Title="çŽ¯å¢ƒå˜é‡ç®¡ç†å™¨" 
        Height="700" Width="1000"
        MinHeight="500" MinWidth="700"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </Window.Resources>

    <Border CornerRadius="12" Background="{StaticResource BackgroundBrush}">
        <Grid>
            <!-- æ¯›çŽ»ç’ƒèƒŒæ™¯æ•ˆæžœ -->
            <Border CornerRadius="12">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#15FFFFFF" Offset="0"/>
                        <GradientStop Color="#08FFFFFF" Offset="0.5"/>
                        <GradientStop Color="#15FFFFFF" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
            </Border>

            <Grid Margin="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="48"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- æ ‡é¢˜æ  -->
                <Border Grid.Row="0" 
                        Background="#10FFFFFF" 
                        CornerRadius="12,12,0,0"
                        MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- æ ‡é¢˜ -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                            <Image Source="/app_icon.png" Width="24" Height="24" VerticalAlignment="Center" Margin="0,0,10,0" RenderOptions.BitmapScalingMode="HighQuality"/>
                            <TextBlock Text="çŽ¯å¢ƒå˜é‡ç®¡ç†å™¨" 
                                       Foreground="{StaticResource TextPrimaryBrush}" 
                                       FontSize="15" 
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- çª—å£æŽ§åˆ¶æŒ‰é’® -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,8,0">
                            <Button x:Name="MinimizeButton" Content="â€”" 
                                    Width="40" Height="32"
                                    Background="Transparent" 
                                    Foreground="{StaticResource TextSecondaryBrush}"
                                    BorderThickness="0" 
                                    FontSize="12"
                                    Click="MinimizeButton_Click"
                                    Cursor="Hand"/>
                            <Button x:Name="MaximizeButton" Content="â˜" 
                                    Width="40" Height="32"
                                    Background="Transparent" 
                                    Foreground="{StaticResource TextSecondaryBrush}"
                                    BorderThickness="0" 
                                    FontSize="14"
                                    Click="MaximizeButton_Click"
                                    Cursor="Hand"/>
                            <Button x:Name="CloseButton" Content="âœ•" 
                                    Width="40" Height="32"
                                    Background="Transparent" 
                                    Foreground="{StaticResource TextSecondaryBrush}"
                                    BorderThickness="0" 
                                    FontSize="12"
                                    Click="CloseButton_Click"
                                    Cursor="Hand"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- ä¸»å†…å®¹åŒºåŸŸ -->
                <Grid Grid.Row="1" Margin="24">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·æ  -->
                    <Grid Grid.Row="0" Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- æœç´¢æ¡† -->
                        <Border Grid.Column="0" 
                                Background="#1A1F2E" 
                                BorderBrush="#3D4663"
                                BorderThickness="1"
                                CornerRadius="10" 
                                MaxWidth="400"
                                HorizontalAlignment="Left">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                           Text="ðŸ”" 
                                           VerticalAlignment="Center" 
                                           Margin="14,0,10,0"
                                           FontSize="14"
                                           Foreground="#A8B4C4"/>
                                <TextBox Grid.Column="1" 
                                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Foreground="{StaticResource TextPrimaryBrush}"
                                         CaretBrush="{StaticResource TextPrimaryBrush}"
                                         VerticalAlignment="Center"
                                         Padding="0,12,14,12"
                                         FontSize="14"
                                         Width="300">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="TextBox">
                                                        <Grid>
                                                            <ScrollViewer x:Name="PART_ContentHost"/>
                                                            <TextBlock Text="æœç´¢çŽ¯å¢ƒå˜é‡..." 
                                                                       Foreground="#6B7280"
                                                                       VerticalAlignment="Center"
                                                                       IsHitTestVisible="False"
                                                                       Visibility="{Binding Text.IsEmpty, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibility}}"/>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                            </Grid>
                        </Border>

                        <!-- æ“ä½œæŒ‰é’® -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="ðŸ”„ åˆ·æ–°" 
                                    Command="{Binding RefreshCommand}"
                                    Style="{StaticResource SecondaryButton}"
                                    Margin="0,0,12,0"/>
                            <Button Content="âž• æ·»åŠ " 
                                    Command="{Binding AddCommand}"
                                    Style="{StaticResource ModernButton}"
                                    Margin="0,0,12,0"/>
                            <Button Content="âœï¸ ç¼–è¾‘" 
                                    Command="{Binding EditCommand}"
                                    Style="{StaticResource SecondaryButton}"
                                    Margin="0,0,12,0"/>
                            <Button Content="ðŸ—‘ï¸ åˆ é™¤" 
                                    Command="{Binding DeleteCommand}"
                                    Style="{StaticResource DangerButton}"/>
                        </StackPanel>
                    </Grid>

                    <!-- æ•°æ®è¡¨æ ¼ -->
                    <Border Grid.Row="1" 
                            Background="#10FFFFFF" 
                            CornerRadius="12"
                            Padding="8">
                        <DataGrid ItemsSource="{Binding FilteredVariables}"
                                  SelectedItem="{Binding SelectedVariable}"
                                  Style="{StaticResource ModernDataGrid}"
                                  IsReadOnly="True"
                                  MouseDoubleClick="DataGrid_MouseDoubleClick">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="åç§°" 
                                                    Binding="{Binding Name}" 
                                                    Width="250">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="VerticalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="å€¼" 
                                                    Binding="{Binding Value}" 
                                                    Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="VerticalAlignment" Value="Center"/>
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>

                <!-- ç¼–è¾‘å¯¹è¯æ¡†é®ç½©å±‚ -->
                <Grid Grid.Row="0" Grid.RowSpan="2" 
                      Visibility="{Binding IsEditing, Converter={StaticResource BoolToVisibility}}">
                    <!-- åŠé€æ˜ŽèƒŒæ™¯ -->
                    <Border Background="#80000000" CornerRadius="12" MouseLeftButtonDown="Overlay_MouseLeftButtonDown"/>
                    
                    <!-- å¯¹è¯æ¡† -->
                    <Border Background="{StaticResource SurfaceBrush}" 
                            CornerRadius="16" 
                            Width="500"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Padding="32">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="40" ShadowDepth="0" Opacity="0.5"/>
                        </Border.Effect>
                        
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- å¯¹è¯æ¡†æ ‡é¢˜ -->
                            <TextBlock Grid.Row="0" 
                                       Text="{Binding EditDialogTitle}" 
                                       FontSize="20" 
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,24"/>

                            <!-- åç§°è¾“å…¥ -->
                            <StackPanel Grid.Row="1" Margin="0,0,0,16">
                                <TextBlock Text="å˜é‡åç§°" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="13"
                                           Margin="0,0,0,8"/>
                                <TextBox x:Name="NameTextBox"
                                         Text="{Binding EditingVariable.Name, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBox}"/>
                            </StackPanel>

                            <!-- å€¼è¾“å…¥ -->
                            <StackPanel Grid.Row="2" Margin="0,0,0,24">
                                <TextBlock Text="å˜é‡å€¼" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="13"
                                           Margin="0,0,0,8"/>
                                <TextBox Text="{Binding EditingVariable.Value, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{StaticResource ModernTextBox}"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         Height="100"
                                         VerticalContentAlignment="Top"/>
                            </StackPanel>

                            <!-- æŒ‰é’® -->
                            <StackPanel Grid.Row="3" 
                                        Orientation="Horizontal" 
                                        HorizontalAlignment="Right">
                                <Button Content="å–æ¶ˆ" 
                                        Style="{StaticResource SecondaryButton}"
                                        Click="CancelButton_Click"
                                        Margin="0,0,12,0"/>
                                <Button Content="ä¿å­˜" 
                                        Style="{StaticResource ModernButton}"
                                        Command="{Binding SaveCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
